<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>ムーンボールマジック(FDS) TAS</title>
</head>

<body>

<h1>ムーンボールマジック(FDS) TAS</h1>

<p>鬼畜ピンボールゲーとして一部で有名な作品。厳密な最適化は結構大変そうなの
で、とりあえずテストラン的なものを作ってみましたが、思っていたよりはスムーズ
に攻略できるようです。</p>

<p>03:48.58 (<a href="MBM-13715F-Done.fcm">fcmファイル</a>)</p>
<iframe width="312" height="176" src="http://ext.nicovideo.jp/thumb/sm7815149" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="http://www.nicovideo.jp/watch/sm7815149">【ニコニコ動画】[TAS] FDS ムーンボールマジック in 03:48.58</a></iframe>
<p>※キー入力は13714Fで終了していますが、ここでムービーを終了するとなぜか再
生終了後に余計な右キー入力が行われてdesyncするので、最後に1Fの無入力を追加し
ています(FCEUのバグ??)。</p>
<p>2009/08/07 追記: 以前アップしたfcmファイルは同一フレームで
FDSINSERT/FDSSELECTの2つのコマンドを実行しているという問題があったため、バイ
ナリ編集で手直ししたものをアップし直しました(ついでに初期ステート無効化など
を行ってファイルサイズを削減)。しかし、やはり最後の無入力フレームを削ると再
生終了後にdesyncしてしまうようです。</p>

<p>少し解析してみたところ、ディスク入れ替え時に B+select+start を押すと上キー
でボールを浮上させられるようになるようですが、これは意図的に用意された裏技と
思われるので、TASでは使用していません。</p>

<p>まだ十分に解析できてませんが、とりあえずわかっていることだけ:</p>
<ul>
  <li>基本的に 2*(速度)+(加速度) の値が毎フレーム座標に加えられるが、加速度は加えられないこともある(条件は未知)</li>
  <li>速度の各成分の絶対値は最大20。ただしブロックを壊したときなどは1Fだけ20を超えることがある</li>
  <li>加速度の各成分の絶対値は最大3</li>
  <li>x/y加速度の絶対値が3のとき、さらに揺らしボタンを押し続けると減速ができる</li>
  <li>面ごとのhex-editingは難しそう(状況を変えるとボールの動きが変化するようだ)</li>
  <li>ワープ中に速度が変化することがある(法則は未知)</li>
  <li>逆アセンブルリストを見ると、各ルーチンの間に 0x4C が挟まっている(解析を阻害するため??)</li>
</ul>


<h2>資料</h2>

<ul>
  <li><a href="memory.txt">メモリマップ</a></li>
</ul>


<hr>

<p><a href="../../">Back</a></p>

</body>
</html>
