<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>快傑ヤンチャ丸3(FC) TAS</title>
</head>

<body>

<h1>快傑ヤンチャ丸3(FC) TAS</h1>

<p>自分が見たいからという単純な動機で作成。良ゲーだと思いますが、RTAには不向
き(タイムを追求するとやたらシビアな操作を要求される上、敵の出現位置などラン
ダム要素が多い)なのが残念。</p>

<p><a href="http://tasvideos.org/1203M.html">TASVideosに掲載されました</a>。
→ <a href="kidniki3-tas-taotao.opt.fcm">fcmoptimで最適化したfcm</a></p>

<iframe width="312" height="176" src="http://ext.nicovideo.jp/thumb/sm4953769" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="http://www.nicovideo.jp/watch/sm4953769">【ニコニコ動画】[TAS] FC 快傑ヤンチャ丸3 in 08:17.62</a></iframe>

<p>タイム短縮のために前方トンボ返りを多用しています。通常、トンボ返りでは後
方にしか飛べませんが、</p>
<ul>
  <li>壁に向かって斜めジャンプ(垂直ジャンプは不可)</li>
  <li>空中で逆方向にキーを入力し、壁と反対方向の速度を発生させる</li>
  <li>再び方向転換して壁の方を向く。この入力は1Fのみ行うこと</li>
  <li>普通にトンボ返りを行う</li>
</ul>
<p>という手順で前方トンボ返りが可能になります。ただし、壁の側面に棒を引っ掛
けないと前方トンボ返りになりません(上面は不可)。よって、高さ1の足場では前方
トンボ返りができません。操作は一応TASでなくとも可能な範囲ではありますが、
100%成功させるのはちょっと厳しいと思います。</p>

<p>敵を5体倒すごとにアイテムが出現しますが、どのアイテムが出現するかはランダ
ムです。巻物(無敵アイテム)を取れると多少タイム短縮が望めるので、必要に応じて
乱数調整を行っています。</p>

<p>このゲームは基本的に1Fおきにしか入力を受け付けず、さらにラグが発生すると
入力受付フレームがずれるようです。一応、入力受付フレームごとに $47 の値がイ
ンクリメントされるようなので、それで判定はできると思うのですが、ボタンを押しっ
ぱなしにする場合、まれに入力受付フレーム以外でもボタンを押していないといけな
いケースがあったりします。そんなわけで慎重を期して全て手動で確認しながら進め
たため、かなり追記回数が多めになっています。</p>

<p>ほとんど資料がなかったので、各種調査はほぼ独力で行わざるを得ませんでした。
現状では解析が不十分なので、まだ新テクニックなどが隠されているかも。</p>

<p>スクロール関連:</p>

<div>
  <img src="EdgeWall-01.png" alt="画面端の見えない壁1" border="0">
  <img src="EdgeWall-02.png" alt="画面端の見えない壁2" border="0">
</div>
<p>左図(4面の最初の扉を抜けた直後)は一見すると右図のように前方トンボ返りで左
の壁を登ってそのまま左へ抜けられるように見えますが、実際にはスクロール境界に
は見えない壁が配置されているようで通り抜けられません。この見えない壁は</p>
<ul>
  <li>地面に足が付いていてもトンボ返りができる</li>
  <li>無限の高さを持つ(ように思われる)</li>
</ul>
<p>という点で通常の壁と異なります。当初は見えない壁を前方トンボ返りで越えら
れれば短縮になるのではと考えていましたが、10万フレーム以上前方トンボ返りを繰
り返しても越えられないので断念しました。一応そのときの
<a href="EdgeWall.fcm">ムービー</a>を置いておきます。</p>

<div><img src="ScrollBug.png" alt="スクロールバグ" border="0"></div>
<p>このゲームは画面スクロールにちょっとしたバグがあるようです。画面がスクロー
ルすべきところでスクロールしないことがあり、その場合上図のように自機が画面外
に出てしまうことがあります(今のところ2面のみで確認)。画面外に出た後はどうも
ハマり状態になるようなので、今のところこれが役に立つことはなさそうです。一応
このバグを再現する<a href="ScrollBug.fcm">ムービー</a>を置いておきます。</p>

<p>雑多なメモ:</p>
<ul>
  <li>自機およびボスの体力は16(クローンのみ10)</li>
  <li>攻撃力はタメ攻撃が5, 直接殴ると3, ショットを当てると1。なお、ラスボス
  にはショットしか当たらない</li>
  <li>足場の端ギリギリまでスライディングしてからジャンプすることでジャンプ距
  離を稼げる</li>
  <li>トンボ返りはボタンを離すタイミングによって軌道が微妙に変化する</li>
  <li>下突きバウンドはAボタンを併用することで高度を変化させられる(3段階)。い
  ずれも通常ジャンプとは微妙に高度が異なるので、着地を早くしたい場合などに使
  える</li>
  <li>下突きバウンドは斜めジャンプよりも少し速い(ただし余計な方向キー入力を
  行うと遅くなる)</li>
  <li>スライディングで崖下に落ちる際は方向キーを入力しない方がわずかに速い</li>
  <li>タメ状態のまま崖から落ちると、構えは解けるがしばらく点滅は続く。この期
  間にBを少しだけ押して離すと、わずかの間タメ攻撃が発動する(実際に攻撃判定を
  持つ)。ただし、崖から落ちたときに勝手に下突きが発動するケースもあり、この
  辺の法則はよくわかっていない。今のところこれらの現象は利用していない。</li>
  <li>左右同時押しでその場足踏みを行う(特に役に立たないと思われる)</li>
</ul>

<p>細かく見ると結構癖のあるシステムで、フレーム単位の最適化が一目でできない
ケースが多いため、TASにおいては試行錯誤が基本になりそうです。</p>

<p>作成した資料:</p>
<ul>
  <li><a href="memory.txt">メモリマップ</a></li>
  <li><a href="random.txt">乱数調査結果</a>, <a href="rand-sim.c">乱数シミュ
  レータもどき</a>(キャリーフラグがクリアされている状態のみを想定)</li>
</ul>


<hr>

<p><a href="../../">Back</a></p>

</body>
</html>
